<div class="template-container">
  <div class="page-header">
    <button class="btn btn-outline" (click)="goBack()">← Back</button>
    <h1>Template Configuration</h1>
    <p>Upload, preview, and manage HTML email templates</p>
  </div>

  <!-- Alert Messages -->
  <div class="alerts">
    <div *ngIf="successMessage" class="alert alert-success">
      <span>✓</span> {{ successMessage }}
    </div>
    <div *ngIf="error" class="alert alert-error">
      <span>✕</span> {{ error }}
    </div>
  </div>

  <div class="container">
    <!-- Campaign ID Input -->
    <div class="campaign-input-section">
      <div class="input-group">
        <label>Campaign ID</label>
        <div class="input-wrapper">
          <input 
            type="text" 
            [(ngModel)]="campaignId"
            placeholder="e.g., summer2024, ABC123"
            (keyup.enter)="loadTemplate()"
          />
          <button class="btn btn-primary" (click)="loadTemplate()" [disabled]="loading">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            Load
          </button>
        </div>
        <p class="hint">Enter a campaign ID to load its template</p>
      </div>
    </div>

    <div *ngIf="selectedTemplate" class="template-content">
      <!-- Template Header -->
      <div class="template-header">
        <div class="template-info">
          <h2>{{ selectedTemplate.filePath.split('/').pop() }}</h2>
          <div class="meta-info">
            <span class="meta-item">
              <strong>File Size:</strong> {{ (selectedTemplate.fileSize / 1024).toFixed(2) }} KB
            </span>
            <span class="meta-item">
              <strong>Backup Status:</strong> 
              <span *ngIf="selectedTemplate.hasBackup" class="badge badge-success">✓ Has Backup</span>
              <span *ngIf="!selectedTemplate.hasBackup" class="badge badge-warning">No Backup</span>
            </span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button 
            *ngIf="!editMode"
            class="btn btn-primary btn-sm" 
            (click)="startEdit()"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            Edit
          </button>
          <button 
            *ngIf="editMode"
            class="btn btn-primary btn-sm" 
            (click)="saveEdit()"
            [disabled]="loading"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
              <polyline points="17 21 17 13 7 13 7 21"></polyline>
              <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
            Save
          </button>
          <button 
            *ngIf="editMode"
            class="btn btn-secondary btn-sm" 
            (click)="cancelEdit()"
          >
            Cancel
          </button>
          <button 
            class="btn btn-secondary btn-sm" 
            (click)="downloadTemplate()"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            Download
          </button>
          <button 
            class="btn btn-secondary btn-sm"
            (click)="togglePreview()"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
            {{ previewMode ? 'Hide Preview' : 'Preview' }}
          </button>
          <button 
            class="btn btn-outline btn-sm"
            style="color: var(--danger-color); border-color: var(--danger-color);"
            (click)="deleteTemplate()"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              <line x1="10" y1="11" x2="10" y2="17"></line>
              <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
            Delete
          </button>
        </div>
      </div>

      <div class="template-view">
        <!-- Edit Mode -->
        <div *ngIf="editMode" class="editor-panel">
          <label>HTML Content</label>
          <textarea 
            [(ngModel)]="editedContent"
            placeholder="Paste or edit your HTML template here..."
          ></textarea>
        </div>

        <!-- Preview Mode -->
        <div *ngIf="previewMode && !editMode" class="preview-panel">
          <h3>Live Preview</h3>
          <iframe 
            [srcdoc]="selectedTemplate.htmlContent"
            class="preview-frame"
          ></iframe>
        </div>

        <!-- Content Display -->
        <div *ngIf="!editMode && !previewMode" class="content-panel">
          <div class="code-container">
            <pre>{{ selectedTemplate.htmlContent }}</pre>
          </div>
        </div>
      </div>
    </div>

    <!-- Upload Template Section -->
    <div *ngIf="campaignId && !selectedTemplate" class="upload-section">
      <div class="upload-box">
        <div class="upload-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="12" y1="18" x2="12" y2="12"></line>
            <line x1="9" y1="15" x2="15" y2="15"></line>
          </svg>
        </div>
        <h2>Upload New Template</h2>
        <p>No template found for this campaign. Upload one now:</p>
        
        <div class="file-input-wrapper">
          <input 
            type="file" 
            #fileInput
            accept=".html"
            (change)="onFileSelected($event)"
            class="file-input"
          />
          <button 
            class="btn btn-secondary"
            (click)="fileInput.click()"
          >
            Choose File
          </button>
        </div>

        <div *ngIf="selectedFile" class="selected-file">
          <p><strong>Selected:</strong> {{ selectedFile.name }}</p>
        </div>

        <div class="backup-option">
          <label>
            <input type="checkbox" [(ngModel)]="createBackup" />
            Create backup before upload
          </label>
        </div>

        <button 
          class="btn btn-primary"
          (click)="uploadTemplate()"
          [disabled]="!selectedFile || loading"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="17 8 12 3 7 8"></polyline>
            <line x1="12" y1="3" x2="12" y2="15"></line>
          </svg>
          {{ loading ? 'Uploading...' : 'Upload Template' }}
        </button>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!selectedTemplate && !campaignId" class="empty-state">
      <div class="empty-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
      </div>
      <h2>Load a Template</h2>
      <p>Enter a campaign ID above to get started</p>
    </div>
  </div>
</div>
